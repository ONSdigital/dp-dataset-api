swagger: "2.0"
info:
  description: "An API used to query information about datasets published by the ONS."
  version: "1.0.0"
  title: "Dataset API"
  license:
    name: "Open Government Licence v3.0"
    url: "http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
basePath: "/v1"
tags:
- name: "Public"
- name: "Private user"
- name: "Private"
schemes:
- "http"
parameters:
  dimension:
    name: dimension
    description: "A dimension from a dataset"
    in: path
    required: true
    type: string
  dimension_option:
    name: dimension_option
    description: "A dimension option from an instance"
    in: body
    schema:
      $ref: '#/definitions/DimensionNode'
  edition:
    name: edition
    description: "An edition of a dataset"
    in: path
    required: true
    type: string
  event:
    name: event
    description: "An event that occurs when importing a dataset"
    in: body
    schema:
      $ref: '#/definitions/Event'
  id:
    name: id
    description: "Id that represents a dataset"
    in: path
    required: true
    type: string
  inserted_observations:
    name: inserted_observations
    description: "A value to increment the inserted_observations within an instance"
    in: path
    required: true
    type: integer
  instance_id:
    name: instance_id
    description: "A unique id for an instance"
    in: path
    required: true
    type: string
  instance:
    name: instance
    description: "An instance related to an import job and dataset"
    in: body
    required: true
    schema:
      $ref: '#/definitions/Instance'
  limit:
    name: limit
    description: "The number of resources to be returned"
    in: query
    type: integer
  new_dataset:
    name: dataset
    description: "A new dataset"
    in: body
    required: true
    schema:
      $ref: '#/definitions/Dataset'
  new_edition:
    name: new_edition
    description: "A new edition of the dataset"
    in: body
    required: true
    schema:
      $ref: '#/definitions/Edition'
  new_version:
    name: new_version
    description: "A new version for an edition of a dataset"
    in: body
    required: true
    schema:
      $ref: '#/definitions/Version'
  node_id:
   name: node_id
   description: "An unique node id"
   in: path
   required: true
   type: string
  offset:
    name: offset
    description: "The first row of resources to retrieve, starting at 0. Use this parameter as a pagination mechanism along with the limit parameter"
    in: query
    type: integer
  newInstance:
    name: instance
    description: "An instance related to an import job"
    in: body
    required: true
    schema:
      $ref: '#/definitions/NewInstance'
  query:
    name: q
    description: "The query text to search datasets with"
    in: query
    type: string
  state:
    name: "state"
    description: "A comma separated list of state values to filter on (e.g. ‘completed,edition-confirmed’)"
    in: query
    type: string
  option:
   name: option
   description: "A option to set within a type"
   in: path
   required: true
   type: string
  version:
    name: version
    description: "A version of a dataset"
    in: path
    required: true
    type: string
  import_tasks:
    name: import_tasks
    description: "A request body to update the state of an import task"
    in: body
    schema:
      $ref: '#/definitions/ImportTasks'
securityDefinitions:
  FlorenceAPIKey:
    name: florence-token
    description: "API key used to allow florence users to create and query the progress of importing a dataset"
    in: header
    type: apiKey
  InternalAPIKey:
    name: internal-token
    description: "API key used to allow only internal services to update the state of an import job"
    in: header
    type: apiKey
  DownloadServiceAPIKey:
    name: x-download-service-token
    description: "API key used to allow the download service to access public and private links to a download"
    in: header
    type: apiKey
paths:
  /search/datasets:
    get:
      tags:
      - "Public"
      summary: "Search for datasets"
      description: "Perform a search on all published datasets by the ONS"
      parameters:
      - $ref: '#/parameters/limit'
      - $ref: '#/parameters/offset'
      - $ref: '#/parameters/query'
      produces:
      - "application/json"
      responses:
        200:
          description: "A json list containing datasets which have been published"
          schema:
            $ref: '#/definitions/Datasets'
        400:
          description: "Body of the post request is invalid"
        500:
          description: "Failed to process the request due to an internal error"
  /datasets:
    get:
      tags:
      - "Public"
      summary: "Get a list of datasets"
      description: "Returns a list of all datasets provided by the ONS that can be filtered using the filter API"
      parameters:
      - $ref: '#/parameters/limit'
      - $ref: '#/parameters/offset'
      produces:
      - "application/json"
      responses:
        200:
          description: "A json list containing datasets which have been published"
          schema:
            $ref: '#/definitions/Datasets'
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}:
    post:
      tags:
      - "Private user"
      summary: "Create a dataset"
      description: "Create a dataset provided by the ONS that can be filtered using the filter API"
      parameters:
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/new_dataset'
      produces:
      - "application/json"
      responses:
        201:
          description: "A json object containing a dataset which has been created"
          schema:
            $ref: '#/definitions/NewDatasetResponse'
        400:
          description: "Invalid request body"
        401:
          description: "Unauthorised to create/overwrite dataset"
        403:
          description: "Forbidden to overwrite dataset, already published"
        500:
          $ref: '#/responses/InternalError'
    get:
      tags:
      - "Public"
      summary: "Get a dataset"
      description: "The dataset contains all high level information, for additional details see editions or versions of a dataset. "
      parameters:
      - $ref: '#/parameters/id'
      responses:
        200:
          description: "A json object for a single Dataset"
          schema:
            $ref: '#/definitions/DatasetResponse'
        404:
          description: "No dataset was found using the id provided"
        500:
          $ref: '#/responses/InternalError'
    put:
      tags:
      - "Private user"
      summary: "Update a dataset"
      description: "Update the metadata for the next release of the dataset. The dataset contains all high level information, for additional details see editions or versions of a dataset."
      parameters:
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/new_dataset'
      responses:
        200:
          description: "A json object for a single Dataset"
          schema:
            $ref: '#/definitions/NewDatasetResponse'
        400:
          description: "Bad Request due to invalid json in request body"
        401:
          description: "Unauthorised to update dataset"
        404:
          description: "No dataset was found using the id provided"
        500:
          $ref: '#/responses/InternalError'
    delete:
      tags:
      - "Private user"
      summary: "Delete a dataset"
      description: "Delete an existing dataset"
      parameters:
      - $ref: '#/parameters/id'
      responses:
        204:
          description: "The dataset was successfully deleted"
        401:
          description: "Unauthorised to delete the dataset"
        403:
          description: "Forbidden to delete dataset, already published"
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}/editions:
    get:
      tags:
      - "Public"
      summary: "Get a list of all editions from a dataset"
      description: "Get a list of editions from a type of dataset"
      parameters:
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/limit'
      - $ref: '#/parameters/offset'
      responses:
        200:
          description: "A json list containing all editions for a dataset"
          schema:
            $ref: '#/definitions/Editions'
        400:
          description: "Invalid request, dataset id was incorrect"
        404:
          description: "No editions were found for the id provided"
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}/editions/{edition}:
    get:
      tags:
      - "Public"
      summary: "Get an edition of a dataset"
      description: "The edition contains a link to all versions"
      parameters:
      - $ref: '#/parameters/edition'
      - $ref: '#/parameters/id'
      responses:
        200:
          description: "A json object containing an edition"
          schema:
            $ref: '#/definitions/Edition'
        400:
          description: "Invalid request, dataset id was incorrect"
        404:
          description: "No edition of a dataset was found using the id and edition provided"
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}/editions/{edition}/versions:
    get:
      tags:
      - "Public"
      summary: "Get a list of all versions from an edition of a dataset"
      description: "Get a list of all versions for an edition of a dataset"
      parameters:
      - $ref: '#/parameters/edition'
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/limit'
      - $ref: '#/parameters/offset'
      responses:
        200:
          description: "A json list containing all versions for a set type of dataset and edition"
          schema:
            $ref: '#/definitions/Versions'
        400:
          description: |
            Invalid request, reasons can be one of the following:
              * dataset id was incorrect
              * edition was incorrect
        404:
          description: "No versions found using the id and edition provided"
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}/editions/{edition}/versions/{version}:
    put:
      tags:
      - "Private user"
      summary: "Update a version for an edition of a dataset"
      description: "Update a version for an edition of a dataset, if the state is changed to associated or published, the parent documents(dataset and edition resources) will also be updated. A version can only be updated if the state is not published"
      parameters:
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/edition'
      - $ref: '#/parameters/version'
      responses:
        201:
          description: "A json object containing a version"
          schema:
            $ref: '#/definitions/NewVersionResponse'
        400:
          description: |
            Invalid request, reasons can be one of the following:
              * invalid request body
              * dataset id was incorrect
              * edition was incorrect
        401:
          description: "Unauthorised to update version of dataset"
        403:
          description: "Forbidden to overwrite version of dataset, already published"
        404:
          description: "Version was not found for a dataset using the id and edition provided"
        500:
          $ref: '#/responses/InternalError'
    get:
      tags:
      - "Public"
      summary: "Get a specific version and edition of a dataset"
      description: "Get a specific version and edition of a dataset"
      parameters:
      - $ref: '#/parameters/edition'
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/version'
      responses:
        200:
          description: "A json object containing the edition and version of a dataset"
          schema:
            $ref: '#/definitions/Version'
        400:
          description: |
            Invalid request, reasons can be one of the following:
              * dataset id was incorrect
              * edition was incorrect
        404:
          description: "No version was found for an edition of a dataset using the id, edition and version provided"
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}/editions/{edition}/versions/{version}/dimensions:
    get:
      tags:
      - "Public"
      summary: "Get all dimensions from a dataset"
      description: "Get all dimensions which are used in the dataset"
      parameters:
      - $ref: '#/parameters/edition'
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/version'
      - $ref: '#/parameters/limit'
      - $ref: '#/parameters/offset'
      responses:
        200:
          description: "A json list of dimensions"
          schema:
            $ref: '#/definitions/Dimensions'
        400:
          description: |
            Invalid request, reasons can be one of the following:
              * dataset id was incorrect
              * edition was incorrect
              * version was incorrect
        404:
          description: "No dimensions found for version of an edition of a dataset using the id, edition and version provided"
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}/editions/{edition}/versions/{version}/dimensions/{dimension}/options:
    get:
      tags:
      - "Public"
      summary: "Get all options from a dimension"
      description: "Get a list of all options which appear in this dimension and dataset"
      parameters:
      - $ref: '#/parameters/dimension'
      - $ref: '#/parameters/edition'
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/version'
      - $ref: '#/parameters/limit'
      - $ref: '#/parameters/offset'
      responses:
        200:
          description: "Json object containing all options for a dimension"
          schema:
            $ref: '#/definitions/DimensionOptions'
        400:
          description: |
            Invalid request, reasons can be one of the following:
              * dataset id was incorrect
              * edition was incorrect
              * version was incorrect
              * dimension was incorrect
        404:
          description: "No dimension options were found for dimension"
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}/editions/{edition}/versions/{version}/metadata:
    get:
      tags:
      - "Public"
      summary: "Get metadata relevant to a version"
      description: "Get all metadata relevant to a version"
      parameters:
      - $ref: '#/parameters/edition'
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/version'
      responses:
        200:
          description: "Json object containing all metadata for a version"
          schema:
            $ref: '#/definitions/MetaData'
        400:
          description: |
            Invalid request, reasons can be one of the following:
              * dataset id was incorrect
              * edition was incorrect
        404:
          description: "Version not found"
        500:
          $ref: '#/responses/InternalError'
  /instances:
    get:
      tags:
      - "Private user"
      summary: "Get a list of instances"
      description: "Get a list of instances which has been paged"
      parameters:
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
        - $ref: '#/parameters/state'
      produces:
      - "application/json"
      security:
      - FlorenceAPIKey: []
      responses:
        200:
          description: "Return a list of instance state"
          schema:
            $ref: '#/definitions/Instances'
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        500:
          $ref: '#/responses/InternalError'
    post:
      tags:
      - "Private"
      summary: "Create an instance"
      description:  |
        Create an instance which will be imported. To create an instance an import job id and href is required. This is to allow a link back to the import job
      parameters:
      - $ref: '#/parameters/newInstance'
      produces:
      - "application/json"
      security:
      - InternalAPIKey: []
      responses:
        200:
          description: "Create an instance then returned it"
          schema:
            $ref: '#/definitions/NewInstance'
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        403:
          $ref: '#/responses/ForbiddenError'
        500:
          $ref: '#/responses/InternalError'
  /instances/{instance_id}:
    get:
      tags:
      - "Private user"
      summary: "Get Information about an instance"
      description: "Get the current state of an instance, this includes all events which have happened."
      parameters:
      - $ref: '#/parameters/instance_id'
      produces:
      - "application/json"
      security:
      - FlorenceAPIKey: []
      responses:
        200:
          description: "Return a single instance state"
          schema:
            $ref: '#/definitions/Instance'
        401:
          $ref: '#/responses/UnauthorisedError'
        404:
          $ref: '#/responses/InstanceNotFound'
        500:
          $ref: '#/responses/InternalError'
    put:
      tags:
      - "Private"
      summary: "Update an instances properties"
      description: "Update an instance by providing an unique id and a set of properties to over write"
      parameters:
      - $ref: '#/parameters/instance_id'
      - $ref: '#/parameters/instance'
      produces:
      - "application/json"
      security:
      - InternalAPIKey: []
      responses:
        200:
          description: "The instance has been updated"
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        403:
          $ref: '#/responses/ForbiddenError'
        404:
          $ref: '#/responses/InstanceNotFound'
        500:
          $ref: '#/responses/InternalError'
  /instances/{instance_id}/dimensions:
    get:
      tags:
      - "Private user"
      summary: "Get all dimensions from an instance"
      description: "Get all dimensions from an instance"
      parameters:
      - $ref: '#/parameters/instance_id'
      produces:
      - "application/json"
      security:
      - InternalAPIKey: []
      responses:
        200:
          description: "Return a list of dimensions"
          schema:
            type: array
            items:
              $ref: '#/definitions/DimensionNode'
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        403:
          $ref: '#/responses/ForbiddenError'
        404:
          $ref: '#/responses/InstanceNotFound'
        500:
          $ref: '#/responses/InternalError'
    post:
      tags:
      - "Private"
      summary: "Create a new dimension"
      description: "Create a new dimension which is related to an instance"
      parameters:
      - $ref: '#/parameters/instance_id'
      - $ref: '#/parameters/dimension_option'
      security:
      - InternalAPIKey: []
      responses:
        201:
          description: "Dimension was created"
        400:
          $ref: '#/responses/InvalidRequestError'
        404:
          $ref: '#/responses/InstanceNotFound'
        500:
          $ref: '#/responses/InternalError'
  /instances/{instance_id}/dimensions/{dimension}:
    put:
      tags:
      - "Private user"
      summary: "Update dimension description and/or label"
      description: "Update the label and/or description of a dimension within an instance, by providing dimension name and properties to over write"
      parameters:
      - $ref: '#/parameters/instance_id'
      - $ref: '#/parameters/dimension'
      - $ref: '#/parameters/instance'
      security:
      - InternalAPIKey: []
      responses:
        200:
          description: "The instance has been updated"
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        403:
          $ref: '#/responses/ForbiddenError'
        404:
          $ref: '#/responses/InstanceNotFound'
        500:
          $ref: '#/responses/InternalError'
  /instances/{instance_id}/dimensions/{dimension}/options:
    get:
      tags:
      - "Private user"
      summary: "Get all unique options from a dimension"
      description: "Get all unique options from a dimension"
      parameters:
      - $ref: '#/parameters/instance_id'
      - $ref: '#/parameters/dimension'
      produces:
      - "application/json"
      security:
      - InternalAPIKey: []
      responses:
        200:
          description: "Return a list of unique options"
          schema:
            type: object
            properties:
              dimension:
                description: "The name of the dimension"
                type: string
              options:
                description: "A list of all unique options within a dimension"
                type: array
                items:
                  type: string
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        403:
          $ref: '#/responses/ForbiddenError'
        404:
          description: "dimension does not match any dimensions within the instance"
        500:
          $ref: '#/responses/InternalError'
  /instances/{instance_id}/events:
    post:
      tags:
       - "Private"
      summary: "Add an event to an instance"
      description: |
        Add a new event into an instance. Events can be for information or error messages.
        Each event must contain a type of event (Info or Error), a message to explain
        the event, time of the event and finally the message offset in kafka
      parameters:
      - $ref: '#/parameters/instance_id'
      - $ref: '#/parameters/event'
      security:
      - InternalAPIKey: []
      responses:
        201:
          description: "The event was added to the instance"
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        404:
          description: "InstanceId does not match any instances"
        500:
          $ref: '#/responses/InternalError'
  /instances/{instance_id}/inserted_observations/{inserted_observations}:
    put:
      tags:
      - "Private"
      summary: "Increment the observation inserted count"
      description: "This will add to the number already store in the api"
      parameters:
      - $ref: '#/parameters/instance_id'
      - $ref: '#/parameters/inserted_observations'
      security:
      - InternalAPIKey: []
      responses:
        200:
          description: "Added value to inserted observation"
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        404:
          description: "InstanceId does not match any instances"
        500:
          $ref: '#/responses/InternalError'
  /instances/{instance_id}/import_tasks:
    put:
      tags:
      - "Private"
      summary: "Update the state of an import task in an instance"
      description: "The instance import process involves multiple tasks. This endpoint updates the state of an import task."
      parameters:
      - $ref: '#/parameters/instance_id'
      - $ref: '#/parameters/import_tasks'
      security:
      - InternalAPIKey: []
      responses:
        200:
          description: "Updated the state of the import task"
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        404:
          description: "InstanceId does not match any instances"
        500:
          $ref: '#/responses/InternalError'
  /instances/{instance_id}/dimensions/{dimension}/options/{option}:
    put:
      tags:
      - "Private"
      summary: "Add an option to a dimension within the instance"
      description: |
        Add a option to a dimension which has been found in the V4 data
      parameters:
      - $ref: '#/parameters/instance_id'
      - $ref: '#/parameters/dimension'
      - $ref: '#/parameters/option'
      produces:
      - "application/json"
      security:
      - InternalAPIKey: []
      responses:
        200:
          description: "The dimension was added"
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        403:
          $ref: '#/responses/ForbiddenError'
        404:
          description: "InstanceId does not match any instances"
        500:
          $ref: '#/responses/InternalError'
  /instances/{instance_id}/dimensions/{dimension}/options/{option}/node_id/{node_id}:
    put:
      tags:
      - "Private"
      summary: "Update a dimension with the node_id"
      description: |
        Update the dimension with a nodeId
      parameters:
      - $ref: '#/parameters/instance_id'
      - $ref: '#/parameters/dimension'
      - $ref: '#/parameters/node_id'
      - $ref: '#/parameters/option'
      produces:
      - "application/json"
      security:
      - InternalAPIKey: []
      responses:
        200:
          description: "Updated the dimension with the nodeId"
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        403:
          $ref: '#/responses/ForbiddenError'
        404:
          description: "InstanceId does not match any instances"
        500:
          $ref: '#/responses/InternalError'
responses:
  InvalidRequestError:
    description: "Failed to process the request due to invalid request"
  InternalError:
    description: "Failed to process the request due to an internal error"
  ForbiddenError:
    description: "The request is forbidden"
  UnauthorisedError:
    description: "The token provided is unauthorised to carry out this operation"
  InstanceNotFound:
    description: "The instance was not found"
definitions:
  AccessRightsLink:
    type: object
    properties:
      href:
        type: string
        description: "A url to the standard Government access right text for the dataset"
  CollectionID:
    type: string
    description: "The id of the unpublished collection (of datasets) that this dataset is associated with"
  Contact:
    description: "A list of objects containing contact information for this dataset"
    type: object
    properties:
      email:
        description: "An email address to contact the statistician"
        type: string
      name:
        description: "The name of the statistician"
        type: string
      telephone:
        description: "Telephone number to contact the statistician"
        type: string
  Datasets:
    description: "A list of datasets"
    type: object
    properties:
      count:
        description: "The number of datasets returned"
        readOnly: true
        type: integer
      items:
        type: array
        items:
          $ref: '#/definitions/DatasetResponse'
      limit:
        description: "The number of datasets requested"
        type: integer
      offset:
        description: "The first row of datasets to retrieve, starting at 0. Use this parameter as a pagination mechanism along with the limit parameter"
        type: integer
      total_count:
        description: "The total number of datasets"
        readOnly: true
        type: integer
  DatasetResponse:
    description: "A model for the response body when getting a dataset"
    allOf:
    - type: object
      properties:
        id:
          readOnly: true
          type: string
          description: "An unique id for a dataset"
          example: "DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC"
    - $ref: "#/definitions/Dataset"
  Dataset:
    description: "The dataset"
    type: object
    properties:
      collection_id:
        $ref: '#/definitions/CollectionID'
      contacts:
        type: array
        description: "A list containing contact details of staticians for a dataset"
        items:
          $ref: '#/definitions/Contact'
      description:
        type: string
        description: "A description for a dataset"
      keywords:
        type: array
        description: "A list of keywords for a dataset"
        items:
          type: "string"
      license:
        description: "The standard Government license right text for the dataset"
        type: string
      links:
        $ref: '#/definitions/DatasetLinks'
      methodologies:
        type: array
        description: "A list of methodologies for a dataset"
        items:
          type: object
          properties:
            description:
              type: string
              description: "The description of a methodology"
            href:
              type: string
              description: "The url to a methodology"
            title:
              type: string
              description: "The title of a methodology"
      national_statistic:
        type: boolean
        description: "The flag indicating the resource is a national statistic. These are certified as compliant with the Code of Practice for Official Statistics"
      next_release:
        type: string
        description: "The next release date for a dataset"
      publications:
        type: array
        description: "A list of publications for a dataset"
        items:
          type: object
          properties:
            description:
              type: string
              description: "The description of a publication"
            href:
              type: string
              description: "The url to a publication"
            title:
              type: string
              description: "The title of a publication"
      publisher:
        $ref: '#/definitions/Publisher'
      qmi:
        description: "Object containing information on the quality and methodology index of a dataset"
        type: object
        properties:
          description:
            type: string
            description: "The description of a quality and methodology index"
          href:
            type: string
            description: "The url to a quality and methodology index"
          title:
            type: string
            description: "The title of a quality and methodology index"
      related_datasets:
        type: array
        description: "A list of objects containing information of datasets related to a dataset"
        items:
          type: object
          properties:
            href:
              type: string
              description: "The url to a related dataset"
            title:
              type: string
              description: "The title of a related dataset"
      release_frequency:
        type: string
        description: "The release frequency of a dataset"
      state:
        $ref: '#/definitions/State'
      theme:
        type: string
        description: "The theme for a dataset"
      title:
        type: string
        description: "The title of the dataset"
        example: "CPI"
      unit_of_measure:
        type: string
        description: "The unit of measure for the dataset observations"
      uri:
        type: string
        description: "The uri to the location of this resource on the web"
  DatasetLinks:
    description: "A list of links related to this resource"
    type: object
    properties:
      access_rights:
        $ref: '#/definitions/AccessRightsLink'
      editions:
        readOnly: true
        type: object
        properties:
          href:
            description: "A URL to all editions for this dataset"
            example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC/editions"
            type: string
      latest_version:
        $ref: '#/definitions/LatestVersionLink'
      self:
        $ref: '#/definitions/SelfLink'
  LatestVersionLink:
    type: object
    readOnly: true
    properties:
      id:
        description: "The unique id for the latest version of a dataset"
        type: "string"
      href:
        description: "A link to the latest version and edition of the dataset"
        example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC/editions/2017/versions/2"
        type: string
  Edition:
    type: object
    properties:
      edition:
        description: "The edition of the dataset"
        example: "2017"
        readOnly: true
        type: string
      id:
        description: "An unique id for a dataset edition"
        readOnly: true
        type: string
      links:
        $ref: '#/definitions/EditionLinks'
      state:
        $ref: '#/definitions/State'
  Editions:
    type: object
    properties:
      count:
        description: "The number of editions returned for a dataset"
        readOnly: true
        type: integer
      items:
        type: array
        items:
          $ref: '#/definitions/Edition'
      limit:
        description: "The number of editions requested for a dataset"
        type: integer
      offset:
        description: "The first row of editions for a dataset to retrieve, starting at 0. Use this parameter as a pagination mechanism along with the limit parameter"
        type: integer
      total_count:
        description: "The total number of editions against a dataset"
        readOnly: true
        type: integer
  EditionLinks:
    description: "A list of links related to this resource"
    readOnly: true
    type: object
    properties:
      dataset:
        $ref: '#/definitions/DatasetLink'
      latest_version:
        $ref: '#/definitions/LatestVersionLink'
      self:
        $ref: '#/definitions/SelfLink'
      versions:
        type: object
        properties:
          href:
            description: "A URL to all versions dor an edition of a dataset"
            example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC/edition/2017/versions"
            type: string
  Event:
    type: object
    properties:
      type:
        type: string
        description: |
          The type of event, this can be;
          * Info - for an information event
          * Error - for an error event
      service:
        type: string
        description: "The name of the service which triggered the event"
      time:
        type: string
        description: "The time of the event in ISO 8601 format"
      message:
        type: string
        description: "A description of the event"
      message_offset:
        type: string
        description: "The kafka message offset (Used to locate the kafka message)"
  Instance:
    type: object
    properties:
      id:
        type: string
        readOnly: true
        description: "A unique id for an instance"
      collection_id:
        $ref: '#/definitions/CollectionID'
      dimensions:
        type: array
        description: "A list of codelists for each dimension of this instance"
        items:
          $ref: '#/definitions/Codelist'
      downloads:
        type: object
        description: "A selection of download objects containing information of downloadable files."
        properties:
          csv:
            $ref: '#/definitions/DownloadFile'
          xls:
            $ref: '#/definitions/DownloadFile'
      edition:
        type: string
        description: "The edition of the dataset version"
      events:
        type: array
        description: "A list of events took place for this job"
        readOnly: true
        items:
          $ref: '#/definitions/Event'
      headers:
        type: array
        description: "The header information from a V4 file"
        items:
          type: string
      import_tasks:
        $ref: '#/definitions/ImportTasks'
      links:
        readOnly: true
        type: object
        properties:
          dataset:
            description: "An object describing the ID and URL for a dataset which is associated with this instance"
            type: object
            readOnly: true
            properties:
              id:
                type: string
                description: "The ID of the dataset associated with this instance"
                example: "95c4669b-3ae9-4ba7-b690-87e890a1c67c"
              href:
                type: string
                description: "The URL for the dataset associated with this instance"
                example: "http://localhost:22000/datasets/95c4669b-3ae9-4ba7-b690-87e890a1c67c"
          dimensions:
            description: "An object describing the URL for the dimensions which are associated with this instance"
            type: object
            readOnly: true
            properties:
              href:
                type: string
                description: "The URL for a list of dimensions associated with this instance"
                example: "http://localhost:22000/datasets/95c4669b-3ae9-4ba7-b690-87e890a1c67c/editions/2017/versions/1/dimensions"
          edition:
            description: "An object describing the ID and URL for the dataset edition that is associated with this instance"
            type: object
            readOnly: true
            properties:
              id:
                type: string
                description: "The ID for the dataset edition associated with this instance"
              href:
                type: string
                description: "The URL for the dataset edition associated with this instance"
                example: "http://localhost:22000/datasets/95c4669b-3ae9-4ba7-b690-87e890a1c67c/editions/2017"
          job:
            description: "An object describing the ID and URL of the job containing this instance"
            type: object
            readOnly: true
            required: ["id", "href"]
            properties:
              id:
                type: string
                description: "The ID of the job containing this instance"
                example: 042e216a-7822-4fa0-a3d6-e3f5248ffc35
              href:
                type: string
                description: "The URL for the job containing this instance"
                example: "http://localhost:21800/jobs/042e216a-7822-4fa0-a3d6-e3f5248ffc35"
          spatial:
            type: object
            properties:
              href:
                type: string
                description: "A url to a list of geography ranges for the version of the dataset"
          version:
            description: "An object describing the ID and URL of the dataset version associated with this instance"
            type: object
            readOnly: true
            properties:
              id:
                type: string
                description: "The ID of the dataset version associated with this instance"
                example: "042e216a-7822-4fa0-a3d6-e3f5248ffc35"
              href:
                type: string
                description: "The URL for the dataset version associated with this instance"
                example: 'http://localhost:21800/dataset/042e216a-7822-4fa0-a3d6-e3f5248ffc35/edition/2017/version/1'
          self:
            description: "An object describing the ID and URL for a dataset which is associated with this instance"
            type: object
            readOnly: true
            properties:
              href:
                type: string
                description: "The URL for this resource"
                example: "http://localhost:22000/instances/45c4669b-3ae9-4ba7-b690-87e890a1c67f"
      release_date:
        description: "The release date of this version of the dataset"
        type: string
      state:
        $ref: '#/definitions/State'
      temporal:
        $ref: '#/definitions/Temporal'
      total_observations:
        type: integer
        description: "The number of observations in this instance"
      version:
        type: integer
        description: "The dataset version number that this instance is associated with, this will only be set once the state has been updated to `edition-confirmed`"
      last_updated:
        type: string
        readOnly: true
        description: "The last time an event happened"
  ImportTasks:
    type: object
    properties:
      import_observations:
        type: object
        properties:
          total_inserted_observations:
            type: integer
            description: "The number of inserted observations in this instance"
          state:
            type: string
            description: "The state of the import observations task"
      build_hierarchies:
        type: array
        items:
          type: object
          properties:
            state:
              type: string
              description: "The state of the import observations task"
            dimension_name:
              type: string
              description: "The name of the dimension the hierarchy represents"
            code_list_id:
              type: string
              description: "The ID of the codelist that this hierarchy represents"
      build_search_indexes:
        type: array
        items:
          type: object
          properties:
            state:
              type: string
              description: "The state of the import observations task"
            dimension_name:
              type: string
              description: "The name of the dimension the search index represents"
  Codelist:
    type: object
    properties:
      id:
        type: string
        description: "The codelist id corresponding to this dimension"
      href:
        type: string
        description: "A link to the codelist corresponding to this dimension"
      name:
        type: string
        description: "The dimension name"
      description:
        type: string
        description: "The dimension description"
      label:
        type: string
        description: "A human readable label for dimension"
  Instances:
    type: object
    properties:
      count:
        description: "The number of instances returned"
        type: integer
      items:
        type: array
        items:
          $ref: '#/definitions/Instance'
      limit:
        description: "The number of instances requested"
        type: integer
      offset:
        description: "The first row of instances to retrieve, starting at 0. Use this parameter as a pagination mechanism along with the limit parameter"
        type: integer
      total_count:
        description: "The total number of instances"
        type: integer
  NewDatasetResponse:
    description: "A model for the response body when creating a new dataset"
    type: object
    properties:
      id:
        type: string
        description: "An unique id for a dataset"
        example: "DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC"
      current:
        allOf:
        - type: object
          properties:
            collection_id:
              $ref: '#/definitions/CollectionID'
        - $ref: "#/definitions/Dataset"
      next:
        allOf:
        - type: object
          properties:
            collection_id:
              $ref: '#/definitions/CollectionID'
        - $ref: "#/definitions/Dataset"
  NewVersionResponse:
    description: "A model for the response body when creating a new version for an edition of a dataset"
    allOf:
      - type: object
        properties:
          id:
            type: string
            description: "An unique id for a dataset"
            example: "DE3BC0B6-D6C4-4E20-917E-95D7EA8C91CD"
          collection_id:
            $ref: '#/definitions/CollectionID'
      - $ref: "#/definitions/Version"
  NewInstance:
    description: "A model for the request and response body for creating a new instance"
    type: object
    properties:
      id:
        type: string
        readOnly: true
        description: "A unique id for an instance"
      dimensions:
        type: array
        description: "A list of codelists for each dimension of this instance"
        items:
          $ref: '#/definitions/Codelist'
      links:
        type: object
        properties:
          dataset:
            description: "An object describing the ID and URL for a dataset which is associated with this instance"
            type: object
            properties:
              id:
                type: string
                description: "The ID of the dataset associated with this instance"
                example: "95c4669b-3ae9-4ba7-b690-87e890a1c67c"
              href:
                type: string
                description: "The URL for the dataset associated with this instance"
                example: "http://localhost:22000/datasets/95c4669b-3ae9-4ba7-b690-87e890a1c67c"
          job:
            description: "An object describing the ID and URL of the job containing this instance"
            type: object
            required: ["id", "href"]
            properties:
              id:
                type: string
                description: "The ID of the job containing this instance"
                example: 042e216a-7822-4fa0-a3d6-e3f5248ffc35
              href:
                type: string
                description: "The URL for the job containing this instance"
                example: "http://localhost:21800/jobs/042e216a-7822-4fa0-a3d6-e3f5248ffc35"
          self:
            description: "An object describing the ID and URL for a dataset which is associated with this instance"
            type: object
            readOnly: true
            properties:
              href:
                type: string
                description: "The URL for this resource"
                example: "http://localhost:22000/instances/45c4669b-3ae9-4ba7-b690-87e890a1c67f"
      state:
        description: "The state of the resource, this can only have a value of `created`"
        type: string
        readOnly: true
  Publisher:
    description: "The publisher of the dataset"
    type: object
    properties:
      name:
        description: "The name of the publisher"
        type: string
      type:
        description: "The type of publisher"
        type: string
      href:
        description: "A link to the publishers homepage"
        type: string
  SelfLink:
    description: "A link to this resource"
    readOnly: true
    type: object
    properties:
      href:
        type: string
  State:
    description: |
      The state of the resource, can only be one of the following:
        * created
        * completed (instances only)
        * failed (instances only)
        * edition-confirmed (instances and versions only)
        * associated (not editions)
        * published
    type: string
  Temporal:
    type: array
    description: "A list of frequencies the dataset covers for a particular period of time"
    items:
      type: object
      properties:
        start_date:
          type: string
          description: "The start date of the time period in which the version of the dataset covers this frequency"
        end_date:
          type: string
          description: "The end date of the time period in which the version of the dataset covers this frequency"
        frequency:
          type: string
          description: "The time frequency the version of the dataset covers for the period of time between start_date and end_date"
  Versions:
    type: object
    properties:
      count:
        description: "The number of versions returned for an edition of a dataset"
        readOnly: true
        type: integer
      items:
        description: "An array of Datasets"
        type: array
        items:
          $ref: '#/definitions/Version'
      limit:
        description: "The number of versions requested for an edition of a dataset"
        type: integer
      offset:
        description: "The first row of versions for an edition of a dataset to retrieve, starting at 0. Use this parameter as a pagination mechanism along with the limit parameter"
        type: integer
      total_count:
        description: "The total number of versions for an edition of a dataset"
        readOnly: true
        type: integer
  Version:
    description: "An object containing information about published datasets from the ONS"
    type: object
    required: [
      release_date,
    ]
    properties:
      alerts:
        type: array
        description: "A list of alerts, for example corrections after the resource has been published"
        items:
          $ref: '#/definitions/Alert'
      collection_id:
        $ref: '#/definitions/CollectionID'
      dimensions:
        type: array
        description: "A list of codelists for each dimension of this version"
        items:
          $ref: '#/definitions/Codelist'
      downloads:
        type: object
        description: "A selection of download objects containing information of downloadable files."
        properties:
          csv:
            $ref: '#/definitions/DownloadFile'
          xls:
            $ref: '#/definitions/DownloadFile'
      edition:
        description: "The dataset edition for this version"
        type: string
        readOnly: true
      instance_id:
        description: "The instance identifier for this version of an edition for a dataset"
        type: string
      latest_changes:
        type: array
        description: "A list of changes between version of an edition for a dataset and the previous version of the same dataset edition"
        items:
          $ref: '#/definitions/LatestChange'
      links:
        $ref: '#/definitions/VersionLinks'
      release_date:
        description: "The release date of this version of the dataset"
        type: string
      state:
        $ref: '#/definitions/State'
      temporal:
        $ref: '#/definitions/Temporal'
      version:
        description: "A number identifying the version for an edition from a dataset"
        example: 1
        readOnly: true
        type: integer
      user_notes:
        description: "A list of user notes relating to the dataset"
        type: array
        items:
          $ref: '#/definitions/UserNote'
  DownloadFile:
    description: "Object containing information of a downloadable file"
    type: object
    properties:
      href:
        type: string
        description: "The URL to the generated file"
      size:
        type: string
        description: "The size of the file in bytes"
      public:
        type: string
        description: "The URL to a public-accessible download"
      private:
        type: string
        description: "The URL to a non public-accessible download"
  Alert:
    # TODO Update description, so it is useful to an API customer
    description: "A single alert, &#x2603;"
    type: object
    properties:
      date:
        # TODO Update description, so it is useful to an API customer
        description: "The date and time of when an alert took place,  &#x2603; for a version"
        type: string
      description:
        # TODO Update description, so it is useful to an API customer
        description: "A description of the alert, &#x2603;"
        type: string
      type:
        description: "The type of alert"
        type: string
        example: "correction"
  LatestChange:
    description: "A single change between this version and the previous version of an edition for a dataset"
    type: object
    properties:
      description:
        description: "A description of what has changed between versions"
        type: string
      name:
        description: "The name of the change that has occurred between versions"
        type: string
        example: "changes in classification"
      type:
        description: "The type of change"
        type: string
        example: "summary of changes"
  SpatialLink:
    type: object
    properties:
      href:
        type: string
        description: "A url to a list of geography ranges for the version of the dataset"
  VersionLinks:
    description: "A list of links related to this resource"
    readOnly: true
    type: object
    properties:
      dataset:
        $ref: '#/definitions/DatasetLink'
      dimensions:
        type: object
        properties:
          href:
            description: "A URL to list dimensions for this version"
            example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC/editions/2017/versions/2/dimensions"
            type: string
      edition:
        $ref: '#/definitions/EditionLink'
      self:
        $ref: '#/definitions/SelfLink'
      spatial:
        $ref: '#/definitions/SpatialLink'
  DatasetLink:
    description: "An object containing the dataset id and link"
    readOnly: true
    type: object
    properties:
      id:
        description: "The unique id for the dataset of this version"
        type: string
      href:
        description: "A URL to the parent dataset for this resource"
        example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC"
        type: string
  EditionLink:
    description: "An object containing the edition and link"
    readOnly: true
    type: object
    properties:
      id:
        description: "The unique id for the dataset edition for a version"
        type: string
      href:
        description: "A URL to the dataset edition for a version"
        example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC/editions/2017"
        type: string
  Dimension:
    description: "A single dimension within a dataset"
    type: object
    properties:
      dimension:
        description: "The name of the dimension"
        type: string
      links:
        type: object
        properties:
          code_list:
            description: "The code list related to this dimension"
            type: object
            properties:
              id:
                description: "The unique id for the code list"
                type: string
              href:
                description: "A URL to the code list"
                type: string
          version:
            $ref: '#/definitions/VersionLink'
  Dimensions:
    type: object
    properties:
      count:
        description: "The number of dimensions returned for a version from an edition of a dataset"
        readOnly: true
        type: integer
      items:
        description: "An array of dimensions"
        type: array
        items:
          $ref: '#/definitions/Dimension'
      limit:
        description: "The number of dimensions requested for a version from an edition of a dataset"
        type: integer
      offset:
        description: "The first row of dimension for a version from an edition of a dataset to retrieve, starting at 0. Use this parameter as a pagination mechanism along with the limit parameter"
        type: integer
      total_count:
        description: "The total number of dimensions against a version from an edition of a dataset"
        readOnly: true
        type: integer
  DimensionOptions:
    type: object
    properties:
      count:
        description: "The number of dimensions returned for a version from an edition of a dataset"
        readOnly: true
        type: integer
      items:
        description: "An array of dimension options"
        type: array
        items:
          $ref: '#/definitions/DimensionOption'
      limit:
        description: "The number of dimensions requested for a version from an edition of a dataset"
        type: integer
      offset:
        description: "The first row of dimension for a version from an edition of a dataset to retrieve, starting at 0. Use this parameter as a pagination mechanism along with the limit parameter"
        type: integer
      total_count:
        description: "The total number of dimensions against a version from an edition of a dataset"
        readOnly: true
        type: integer
  DimensionOption:
    type: object
    properties:
      dimension:
        description: "The name of the dimension"
        type: string
      label:
        description: "A label given to a dimension option"
        type: string
      option:
        description: "An option for a dimension"
        type: string
      links:
        description: "A object with all resources related to a dimension option"
        type: object
        properties:
          code:
            description: "A link to the code of the option"
            type: object
            properties:
              id:
                type: string
                description: "The id of the code that refers to this dimension"
              href:
                type: string
                description: "The url of the code that refers to this dimension"
          code_list:
            description: "A link to the code list the options belongs too"
            type: object
            properties:
              id:
                type: string
                description: "The id of the code list that this dimension code belongs"
              href:
                type: string
                description: "The url of the code list that this dimension code belongs"
  DimensionNode:
    type: object
    description: "A cached dimension. (Only used by the Private API)"
    properties:
      dimension:
        description: "The name of the dimension"
        type: string
      option:
        description: "The option of the dimension"
        type: string
      label:
        description: "The label for a option"
        type: string
      node_id:
        description: "The id of the node"
        type: string
  MetaData:
    type: object
    description: "An object containing all metadata information against a version"
    properties:
      alerts:
        type: array
        description: "A list of alerts, for example corrections after the resource has been published"
        items:
          $ref: '#/definitions/Alert'
      contacts:
        type: array
        description: "A list containing contact details of staticians for a dataset"
        items:
          $ref: '#/definitions/Contact'
      description:
        type: string
        description: "A description for a dataset"
      distribution:
        type: array
        description: "A list of media types that the version data of an edition of a dataset can be accessed"
        items:
          type: string
      dimensions:
        type: array
        description: "A list of codelists for each dimension of this version"
        items:
          $ref: '#/definitions/Codelist'
      downloads:
        type: object
        description: "A selection of download objects containing information of downloadable files."
        properties:
          csv:
            $ref: '#/definitions/DownloadFile'
          xls:
            $ref: '#/definitions/DownloadFile'
      keywords:
        type: array
        description: "A list of keywords for a dataset"
        items:
          type: "string"
      latest_changes:
        type: array
        description: "A list of changes between version of an edition for a dataset and the previous version of the same dataset edition"
        items:
          $ref: '#/definitions/LatestChange'
      license:
        description: "The standard Government license right text for the dataset"
        type: string
      links:
        $ref: '#/definitions/MetaDataLinks'
      methodologies:
        type: array
        description: "A list of methodologies for a dataset"
        items:
          type: object
          properties:
            description:
              type: string
              description: "The description of a methodology"
            href:
              type: string
              description: "The url to a methodology"
            title:
              type: string
              description: "The title of a methodology"
      national_statistic:
        type: boolean
        description: "The flag indicating the resource is a national statistic. These are certified as compliant with the Code of Practice for Official Statistics"
      next_release:
        type: string
        description: "The next release date for a dataset"
      publications:
        type: array
        description: "A list of publications for a dataset"
        items:
          type: object
          properties:
            description:
              type: string
              description: "The description of a publication"
            href:
              type: string
              description: "The url to a publication"
            title:
              type: string
              description: "The title of a publication"
      publisher:
        $ref: '#/definitions/Publisher'
      qmi:
        description: "Object containing information on the quality and methodology index of a dataset"
        type: object
        properties:
          description:
            type: string
            description: "The description of a quality and methodology index"
          href:
            type: string
            description: "The url to a quality and methodology index"
          title:
            type: string
            description: "The title of a quality and methodology index"
      related_datasets:
        type: array
        description: "A list of objects containing information of datasets related to a dataset"
        items:
          type: object
          properties:
            href:
              type: string
              description: "The url to a related dataset"
            title:
              type: string
              description: "The title of a related dataset"
      release_date:
        description: "The release date of this version of the dataset"
        type: string
      release_frequency:
        type: string
        description: "The release frequency of a dataset"
      temporal:
        $ref: '#/definitions/Temporal'
      theme:
        type: string
        description: "The theme for a dataset"
      title:
        type: string
        description: "The title of the dataset"
        example: "CPI"
      unit_of_measure:
        type: string
        description: "The unit of measure for the dataset observations"
      uri:
        type: string
        description: "The uri to the location of the dataset on the web"
  MetaDataLinks:
    type: object
    description: "A list of links related to this resource"
    properties:
      access_right:
        $ref: '#/definitions/AccessRightsLink'
      self:
        $ref: '#/definitions/SelfLink'
      spatial:
        $ref: '#/definitions/SpatialLink'
      version:
        $ref: '#/definitions/VersionLink'
  VersionLink:
    description: "The dataset version this resource belongs to"
    type: object
    properties:
      id:
        description: "The version number this resource relates to"
        type: string
      href:
        description: "A URL to the version this resource relates to"
        type: string
  UserNote:
    description: "A note relating to the dataset. This will appear in downloaded datasets"
    type: object
    properties:
      title:
        description: "The title of the note"
        type: string
      note:
        description: "The content of the note"
        type: string
