swagger: "2.0"
info:
  description: "Used to find information about data published by the ONS.
  `Datasets` are published in unique `versions`, which are categorized by `edition`.
  Data in each version is broken down by `dimensions`, and a unique combination
  of dimension `options` in a version can be used to retrieve `observation` level data."
  version: "1.0.0"
  title: "Explore our data"
  license:
    name: "Open Government Licence v3.0"
    url: "http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
basePath: "/v1"
tags:
- name: "Public"
- name: "Private user"
- name: "Private"
schemes:
- "http"
parameters:
  dataset:
    name: dataset
    description: "A unique id for a dataset to filter on"
    in: query
    type: string
  edition:
    name: edition
    description: "An edition of a dataset"
    in: path
    required: true
    type: string
  event:
    name: event
    description: "An event that occurs when importing a dataset"
    in: body
    schema:
      $ref: '#/definitions/Event'
  id:
    name: id
    description: "Id that represents a dataset"
    in: path
    required: true
    type: string
  instance_id:
    name: instance_id
    description: "A unique id for an instance"
    in: path
    required: true
    type: string
  instance:
    name: instance
    description: "An instance related to an import job and dataset"
    in: body
    required: true
    schema:
      $ref: '#/definitions/Instance'
  new_dataset:
    name: dataset
    description: "A new dataset"
    in: body
    required: true
    schema:
     allOf:
        - type: object
          properties:
            type:  
              $ref: '#/definitions/Type'
        - $ref: "#/definitions/Dataset"
  new_edition:
    name: new_edition
    description: "A new edition of the dataset"
    in: body
    required: true
    schema:
      $ref: '#/definitions/Edition'
  new_version:
    name: new_version
    description: "A new version for an edition of a dataset"
    in: body
    required: true
    schema:
      $ref: '#/definitions/Version'
  newInstance:
    name: instance
    description: "An instance related to an import job"
    in: body
    required: true
    schema:
      $ref: '#/definitions/NewInstance'
  state:
    name: "state"
    description: "A comma separated list of state values to filter on (e.g. ‘completed,edition-confirmed’)"
    in: query
    type: string
  update_dataset:
    name: dataset
    description: "An update to a dataset"
    in: body
    required: true
    schema:
      $ref: "#/definitions/Dataset"
  version:
    name: version
    description: "A version of a dataset"
    in: path
    required: true
    type: string
  version_update:
    name: version_update
    description: "Update to a version for an edition of a dataset"
    in: body
    required: true
    schema:
      $ref: '#/definitions/UpdateVersion'
  limit:
    name: limit
    description: "Maximum number of items that will be returned. A value of zero will return zero items. The default value is 20, and the maximum limit allowed is 1000"
    in: query
    required: false
    type: integer
  offset:
    name: offset
    description: "Starting index of the items array that will be returned. By default it is zero, meaning that the returned items will start from the beginning."
    in: query
    required: false
    type: integer
  ids:
    name: id
    description: "List of ids, as comma separated values and/or as multiple query parameters with the same key (e.g. 'id=op1,op2&id=op3'). It defines the IDs that we want to retrieve. If provided, it takes precedence over offset and limit."
    in: query
    required: false
    type: string
  if_match:
    name: If-Match
    required: false
    description: "Filter resource version, as returned by a previous ETag, to be validated; or '*' to skip the version check"
    in: header
    type: string
  is_based_on:
    name: is_based_on
    required: false
    description: "A population type to search on to return datasets that are associated with that population type e.g. Usual-Residents.  This is applicable to Census 2021 datasets only."
    in: query
    type: string
securityDefinitions:
  FlorenceAPIKey:
    name: florence-token
    description: "API key used to allow florence users to create and query the progress of importing a dataset"
    in: header
    type: apiKey
  InternalAPIKey:
    name: internal-token
    description: "API key used to allow only internal services to update the state of an import job"
    in: header
    type: apiKey
  DownloadServiceAPIKey:
    name: x-download-service-token
    description: "API key used to allow the download service to access public and private links to a download"
    in: header
    type: apiKey
paths:
  /datasets:
    get:
      tags:
      - "Public"
      summary: "Get a list of datasets"
      description: "Returns a list of all datasets in the ONS Data Catalogue"
      parameters: 
      - $ref: '#/parameters/is_based_on'
      - $ref: '#/parameters/limit'
      - $ref: '#/parameters/offset'
      produces:
      - "application/hal+json"
      - "application/ld+json"
      - "application/json"
      responses:
        200:
          description: "A json list containing datasets which have been published"
          schema:
            $ref: '#/definitions/Datasets'
        400:
          description: "Parameter is_based_on was sent but no value was provided"
        404:
          description: "No dataset was found with the popultation-type provided"
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}:
    post:
      tags:
      - "Private user"
      summary: "Create a dataset"
      description: "Create a dataset provided by the ONS that can be filtered using the filter API"
      parameters:
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/new_dataset'
      produces:
      - "application/json"
      responses:
        201:
          description: "A json object containing a dataset which has been created"
          schema:
            $ref: '#/definitions/NewDatasetResponse'
        400:
          description: "Invalid request body"
        401:
          description: "Unauthorised to create/overwrite dataset"
        403:
          description: "Forbidden to overwrite dataset, already published"
        500:
          $ref: '#/responses/InternalError'
    get:
      tags:
      - "Public"
      summary: "Get a dataset"
      description: "The dataset contains all high level information, for additional details see editions or versions of a dataset. "
      parameters:
      - $ref: '#/parameters/id'
      produces:
      - "application/hal+json"
      - "application/ld+json"
      - "application/json"
      responses:
        200:
          description: "A json object for a single Dataset"
          schema:
            $ref: '#/definitions/Dataset'
        404:
          description: "No dataset was found using the id provided"
        500:
          $ref: '#/responses/InternalError'
    put:
      tags:
      - "Private user"
      summary: "Update a dataset"
      description: "Update the metadata for the next release of the dataset. The dataset contains all high level information, for additional details see editions or versions of a dataset."
      parameters:
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/update_dataset'
      responses:
        200:
          description: "A json object for a single Dataset"
        400:
          description: "Bad Request due to invalid json in the request body"
        401:
          description: "Unauthorised to update dataset"
        404:
          description: "No dataset was found using the id provided"
        500:
          $ref: '#/responses/InternalError'
    delete:
      tags:
      - "Private user"
      summary: "Delete a dataset"
      description: "Delete an existing dataset"
      parameters:
      - $ref: '#/parameters/id'
      responses:
        204:
          description: "The dataset was successfully deleted"
        401:
          description: "Unauthorised to delete the dataset"
        403:
          description: "Forbidden to delete dataset, already published"
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}/editions:
    get:
      tags:
      - "Public"
      summary: "Get a list of editions of a dataset"
      description: "Get a list of editions of a type of dataset"
      parameters:
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/limit'
      - $ref: '#/parameters/offset'
      produces:
      - "application/hal+json"
      - "application/ld+json"
      - "application/json"
      responses:
        200:
          description: "A json list containing all editions for a dataset"
          schema:
            $ref: '#/definitions/Editions'
        400:
          description: "Invalid request, dataset id was incorrect"
        404:
          description: "No editions were found for the id provided"
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}/editions/{edition}:
    get:
      tags:
      - "Public"
      summary: "Get an edition of a dataset"
      description: "The edition contains a link to all versions"
      parameters:
      - $ref: '#/parameters/edition'
      - $ref: '#/parameters/id'
      produces:
      - "application/hal+json"
      - "application/ld+json"
      - "application/json"
      responses:
        200:
          description: "A json object containing an edition"
          schema:
            $ref: '#/definitions/Edition'
        400:
          description: "Invalid request, dataset id was incorrect"
        404:
          description: "No edition of a dataset was found using the id and edition provided"
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}/editions/{edition}/versions:
    get:
      tags:
      - "Public"
      summary: "Get a list of versions of an edition"
      description: "Get a list of all versions for an edition of a dataset"
      parameters:
      - $ref: '#/parameters/edition'
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/limit'
      - $ref: '#/parameters/offset'
      produces:
      - "application/hal+json"
      - "application/ld+json"
      - "application/json"
      responses:
        200:
          description: "A json list containing all versions for a set type of dataset and edition"
          schema:
            $ref: '#/definitions/Versions'
        400:
          description: |
            Invalid request, reasons can be one of the following:
              * dataset id was incorrect
              * edition was incorrect
        404:
          description: "No versions found using the id and edition provided"
        500:
          $ref: '#/responses/InternalError'
  /datasets/{id}/editions/{edition}/versions/{version}:
    put:
      tags:
      - "Private user"
      summary: "Update a version"
      description: "Update a version for an edition of a dataset, if the state is changed to associated or published, the parent documents(dataset and edition resources) will also be updated. A version can only be updated if the state is not published"
      parameters:
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/edition'
      - $ref: '#/parameters/version'
      - $ref: '#/parameters/version_update'
      responses:
        201:
          description: "A json object containing a version"
          schema:
            $ref: '#/definitions/NewVersionResponse'
        400:
          description: |
            Invalid request, reasons can be one of the following:
              * invalid request body
              * dataset id was incorrect
              * edition was incorrect
        401:
          description: "Unauthorised to update version of dataset"
        403:
          description: "Forbidden to overwrite version of dataset, already published"
        404:
          description: "Version was not found for a dataset using the id and edition provided"
        500:
          $ref: '#/responses/InternalError'
    get:
      tags:
      - "Public"
      summary: "Get a version"
      description: "Get a specific version of an edition of a dataset"
      parameters:
      - $ref: '#/parameters/edition'
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/version'
      produces:
      - "application/hal+json"
      - "application/ld+json"
      - "application/json"
      responses:
        200:
          description: "A json object containing the edition and version of a dataset"
          schema:
            $ref: '#/definitions/Version'
          headers:
            ETag:
              type: string
              description: "Defines the unique etag for this resource"
        400:
          description: |
            Invalid request, reasons can be one of the following:
              * dataset id was incorrect
              * edition was incorrect
        404:
          description: "No version was found for an edition of a dataset using the id, edition and version provided"
        500:
          $ref: '#/responses/InternalError'
    delete:
      tags:
      - "Private"
      summary: "Delete a version"
      description: "detaches a version from a collection. Effectively a soft delete."
      parameters:
      - $ref: '#/parameters/edition'
      - $ref: '#/parameters/id'
      - $ref: '#/parameters/version'
      security:
            - InternalAPIKey: []
      responses:
        200:
          description: "A json object containing the edition and version of a dataset"
          schema:
            $ref: '#/definitions/Version'
        400:
          description: |
            Invalid request, reasons can be one of the following:
              * dataset id was incorrect
              * edition was incorrect
              * version state was incorrect
              * not the most recent unpublished version
        404:
          description: "No version was found for an edition of a dataset using the id, edition and version provided"
        500:
          $ref: '#/responses/InternalError'
  /instances:
    get:
      tags:
      - "Private user"
      summary: "Get instances"
      description: "Get a list of instances which has been paged"
      parameters:
        - $ref: '#/parameters/state'
        - $ref: '#/parameters/dataset'
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
      produces:
      - "application/json"
      security:
      - FlorenceAPIKey: []
      responses:
        200:
          description: "Return a list of instance state"
          schema:
            $ref: '#/definitions/Instances'
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        500:
          $ref: '#/responses/InternalError'
    post:
      tags:
      - "Private"
      summary: "Create an instance"
      description:  |
        Create an instance which will be imported. To create an instance an import job id and href is required. This is to allow a link back to the import job
      parameters:
      - $ref: '#/parameters/newInstance'
      produces:
      - "application/json"
      security:
      - InternalAPIKey: []
      responses:
        201:
          description: "Successfully created instance"
          schema:
            $ref: '#/definitions/NewInstance'
          headers:
            ETag:
              type: string
              description: "Defines a unique instance resource version"
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        403:
          $ref: '#/responses/ForbiddenError'
        500:
          $ref: '#/responses/InternalError'
  /instances/{instance_id}:
    get:
      tags:
      - "Private user"
      summary: "Get an instance"
      description: "Get the current state of an instance, this includes all events which have happened."
      parameters:
      - $ref: '#/parameters/instance_id'
      - $ref: '#/parameters/if_match'
      produces:
      - "application/json"
      security:
      - FlorenceAPIKey: []
      responses:
        200:
          description: "Return a single instance state"
          schema:
            $ref: '#/definitions/Instance'
          headers:
            ETag:
              type: string
              description: "Defines a unique instance resource version"
        401:
          $ref: '#/responses/UnauthorisedError'
        404:
          $ref: '#/responses/InstanceNotFound'
        409:
          $ref: '#/responses/ConflictError'
        500:
          $ref: '#/responses/InternalError'
    put:
      tags:
      - "Private"
      summary: "Update an instance"
      description: "Update an instance by providing an unique id and a set of properties to over write"
      parameters:
      - $ref: '#/parameters/instance_id'
      - $ref: '#/parameters/instance'
      - $ref: '#/parameters/if_match'
      produces:
      - "application/json"
      security:
      - InternalAPIKey: []
      responses:
        200:
          description: "The instance has been updated"
          headers:
            ETag:
              type: string
              description: "Defines a unique instance resource version"
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        403:
          $ref: '#/responses/ForbiddenError'
        404:
          $ref: '#/responses/InstanceNotFound'
        409:
          $ref: '#/responses/ConflictError'
        500:
          $ref: '#/responses/InternalError'
  /instances/{instance_id}/events:
    post:
      tags:
       - "Private"
      summary: "Add an event to an instance"
      description: |
        Add a new event into an instance. Events can be for information or error messages.
        Each event must contain a type of event (Info or Error), a message to explain
        the event, time of the event and finally the message offset in kafka
      parameters:
      - $ref: '#/parameters/instance_id'
      - $ref: '#/parameters/event'
      - $ref: '#/parameters/if_match'
      security:
      - InternalAPIKey: []
      responses:
        201:
          description: "The event was added to the instance"
          headers:
            ETag:
              type: string
              description: "Defines a unique instance resource version"
        400:
          $ref: '#/responses/InvalidRequestError'
        401:
          $ref: '#/responses/UnauthorisedError'
        404:
          description: "InstanceId does not match any instances"
        409:
          $ref: '#/responses/ConflictError'
        500:
          $ref: '#/responses/InternalError'
responses:
  ConflictError:
    description: "Failed to process the request due to a conflict"
  ForbiddenError:
    description: "The request is forbidden"
  InstanceNotFound:
    description: "The instance was not found"
  InternalError:
    description: "Failed to process the request due to an internal error"
  InvalidRequestError:
    description: "Failed to process the request due to invalid request"
  UnauthorisedError:
    description: "The token provided is unauthorised to carry out this operation"
definitions:
  Alert:
    description: "Important information relating to a version of a dataset"
    type: object
    properties:
      date:
        description: "The date and time of when an alert took place"
        type: string
      description:
        description: "Detail of what a user needs to be aware of for this dataset"
        type: string
      type:
        description: "The type of alert"
        example: "correction"
        type: string
  CollectionID:
    description: "The id of the unpublished collection (of datasets) that this dataset is associated with"
    type: string
  Agent:
    description: "A foaf:agent compliant object containing contact information for this resource"
    type: object
    properties:
      email:
        description: "An email address to contact the statistician"
        type: string
      name:
        description: "The name of the statistician"
        type: string
      telephone:
        description: "Telephone number to contact the statistician"
        type: string
  dcatSeriesCore:
    description: "Core properties needed for dcat:Dataset and dcat:DatasetSeries objects"
    properties:
      description:
        description: "A description for a dataset. Could contain markdown"
        type: string
      identifier:
        description: "The identifier for this dataset. This will form the last part of the URI for this resource"
        type: string
      issued:
        description: "The date the dataset was first issued"
        type: string
        format: date-time
      license:
        description: "The standard Government license right text for the dataset"
        type: string
        default: "http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
      modified:
        description: "The date the dataset was modified"
        type: string
        format: date-time
      next_release:
        description: "The next release date for a dataset"
        type: string
        format: date-time
      publisher:
        $ref: '#/definitions/Agent'
      frequency:
        description: "The release frequency of a dataset"
        type: string
      spatial_coverage:
        description: "The spatial area covered by the dataset, typically a code defining a geographic area which contains all the observed areas"
        type: string
      spatial_resolution:
        description: "A list of the types geographic areas contained in the dataset"
        type: array
        items:
          type: "string"
      summary:
        description: "A short summary of a dataset."
        type: string
      temporal_coverage:
        description: "The overall time period covered by the dataset"
        type: "string"
        format: duration
      temporal_resolution:
        description: "A list of the types time periods contained in the dataset"
        type: array
        items:
          type: "string"
          format: duration
      title:
        description: "The title of the dataset"
        example: "CPI"
        type: string
  dcatSeriesFull:
    description: "All properties needed for full dcat:DatasetSeries or dcat:Dataset objects"
    allOf:
    - $ref: '#/definitions/dcatSeriesCore'
    - type: object
      properties:
        contact_point:
          $ref: '#/definitions/Agent'
        keywords:
          description: "A list of keywords for a dataset, typically to help with Search Engine Optimisation"
          type: array
          items:
            type: "string"
        themes:
          description: "The themes a dataset relates to. These will be the identifiers for what may be referred to as 'topics' on the website, and used for navigation and breadcrumbs"
          type: array
          items:
            type: string
  dcatVersionCore:
    description: "core quality, mangement and relationship fields for describing a dcat:dataset version"
    type: object
    properties:
      distributions:
        description: "A selection of download objects containing information of downloadable files."
        type: array
        items:
          allOf:
            - type: object
              properties:
                checksum:
                  description: "spdx:checksum - some guarantees, hence not etag. Could be a more complex object?"
                  type: string
            - $ref: '#/definitions/DownloadObject'
      version:
        description: "A number identifying the version for an edition from a dataset"
        example: 1
        readOnly: true
        type: integer
      version_notes:
        description: "A list of notes, for example corrections after the resource has been published"
        type: array
        items: 
          type: string
  dcatVersionFull:
    description: "All properties needed for complete dcat:Dataset version objects"
    allOf:
    - $ref: '#/definitions/dcatVersionCore'
    - type: object
      properties:
        next_version:
          type: string
          format: uri
        previous_version:
          type: string
          format: uri
        distributions:
          description: "A selection of download objects containing information of downloadable files."
          type: array
          items:
            allOf:
              - $ref: '#/definitions/CSVDownload'
              - $ref: '#/definitions/DownloadObject'
  Datasets:
    description: "A list of datasets"
    type: object
    allOf:
      - $ref: '#/definitions/ListPagination'
      - type: object
        properties:
          "@context":
            $ref: '#/definitions/LDContext'
          items:
            type: array
            items:
              allOf:
              - $ref: '#/definitions/dcatSeriesCore'
              - type: object
                properties:
                  "@id":
                    $ref: '#/definitions/LDID'
                  "@type":
                    allOf:
                    - $ref: '#/definitions/LDType'
                    - default: "dcat:datasetSeries"
                  is_based_on:
                    $ref: '#/definitions/IsBasedOn'
                  _links:
                    $ref: '#/definitions/DatasetListLinks'
                  national_statistic:
                    description: "The flag indicating the resource is a national statistic. These are certified as compliant with the Code of Practice for Official Statistics"
                    type: boolean
                  state:
                    $ref: '#/definitions/State'
                  survey:
                    description: "The name of the survey the dataset was created from."
                    type: string
                  type:
                    $ref: '#/definitions/Type'
  LDContext:
    description: "The URL for the JSON-LD context. The field name will be '@context'"
    type: string
    format: uri
  LDID:
    description: "The URL of the current resource, the same as links.self"
    type: string
    format: uri
  LDType:
    description: "The linked data vocabulary term for a dataset"
    default: "dcat:datasetSeries"
    type: string
  Dataset:
    description: "The dataset"
    type: object
    required: ["identifier", "@context", "contact_point", "creator", "description", "@id", "issued", "license", "editions", "latest_version", "publisher", "frequency", "spatial_coverage", "spatial_resolution", "state", "temporal_coverage", "temporal_resolution", "title", "type", "@type"]
    allOf:
    - $ref: '#/definitions/dcatSeriesFull'
    - type: object
      properties:
        "@context":
          $ref: '#/definitions/LDContext'
        "@id":
          $ref: '#/definitions/LDID'
        "@type":
          $ref: '#/definitions/LDType'
        canonical_topic:
          description: "The canonical topic id for this dataset.  This indicates which topic this dataset belongs to within the website taxonomy."
          type: string
        collection_id:
          description: "Should only be available privately"
          allOf:
          - $ref: '#/definitions/CollectionID'
        _embedded:
          type: object
          properties:
            editions:
              description: "Likely described as a 'seeAlso' term"
              type: array
              items:
                type: object
                properties:
                  "@id":
                    $ref: '#/definitions/LDID'
                  issued:
                    description: "The date the edition was first issued"
                    type: string
                    format: date-time
                  etag:
                    type: string
        is_based_on:
          $ref: '#/definitions/IsBasedOn'
        _links:
          $ref: '#/definitions/DatasetLinks'
        national_statistic:
          description: "The flag indicating the resource is a national statistic. These are certified as compliant with the Code of Practice for Official Statistics"
          type: boolean
        state:
          $ref: '#/definitions/State'
        survey:
          description: "The name of the survey the dataset was created from."
          type: string
        type:
          $ref: '#/definitions/Type'
  Type:
    description: "The type for a dataset" 
    type: string
    enum: [filterable, nomis, cantabular_flexible_table, static]
    default: "static"    
  IsBasedOn:
    description: "Information about the population-type that the dataset is based on (census 2021 only)" 
    type: object
    properties:
      id:
        description: "The population-type that the dataset is based on"
        type: string
        example: "Usual-Residents"
      type:
        description: "The type of the dataset"
        type: string
        example: "cantabular_table"
  CSVDownload:
    description: "Additional fields available for CSV downloads"
    type: object
    properties:
      checksum:
        description: "spdx:checksum - some guarantees, hence not etag. Could be a more complex object? -- only available for CSVs we expect"
        type: string
      described_by:
        type: string
      table_schema:
        $ref: '#/definitions/TableSchema'
  DownloadObject:
    description: "Object containing information of a downloadable file"
    type: object
    properties:
      "@id":
        description: "The URL to the generated file"
        type: string
      byte_size:
        description: "The size of the file in bytes"
        type: string
      media_type:
        description: "The MIME type for Accept and Content-Type headers"
        type: string
      download_url:
        description: "The URL to download the file -- WHY??? isn't this @ID??"
        type: string
  Edition:
    type: object
    required: ["identifier", "@context", "contact_point", "creator", "description", "@id", "issued", "license", "editions", "latest_version", "publisher", "frequency", "spatial_coverage", "spatial_resolution", "state", "temporal_coverage", "temporal_resolution", "title", "@type"]
    allOf:
    - $ref: '#/definitions/dcatSeriesFull'
    - $ref: '#/definitions/dcatVersionFull'
    - type: object
      properties:
        "@context":
          $ref: '#/definitions/LDContext'
        "@id":
          $ref: '#/definitions/LDID'
        "@type":
          $ref: '#/definitions/LDType'
        etag:
          type: string
        is_based_on:
          $ref: '#/definitions/IsBasedOn'
        _links:
          $ref: '#/definitions/EditionLinks'
        type:
          $ref: '#/definitions/Type'
        next_edition:
          type: string
          format: uri
        previous_edition:
          type: string
          format: uri
        state:
          $ref: '#/definitions/State'
        
  Editions:
    type: object
    allOf:
      - $ref: '#/definitions/ListPagination'
      - type: object
        properties:
          "@context":
            $ref: '#/definitions/LDContext'
          items:
            type: array
            items:
              allOf:
              - $ref: '#/definitions/dcatSeriesCore'
              - $ref: '#/definitions/dcatVersionCore'
              - type: object
                properties:
                  etag:
                    type: string
                  "@id":
                    $ref: '#/definitions/LDID'
                  "@type":
                    $ref: '#/definitions/LDType'
                  _links:
                    $ref: '#/definitions/SelfLink'
                  state:
                    $ref: '#/definitions/State'
  Event:
    type: object
    properties:
      message:
        description: "A description of the event"
        type: string
      message_offset:
        description: "The kafka message offset (Used to locate the kafka message)"
        type: string
      time:
        description: "The time of the event in ISO 8601 format"
        type: string
      type:
        description: |
          The type of event, this can be;
          * Info - for an information event
          * Error - for an error event
        type: string
  Instance:
    type: object
    properties:
      version_notes:
        description: "Notes describing what is unique to this particular version"
        readOnly: true
        items:
          type: string
      identifier:
        description: "A unique id for an instance"
        readOnly: true
        type: string
      collection_id:
        $ref: '#/definitions/CollectionID'
      creator:
        type: string
        format: url
      downloads:
        description: "A selection of download objects containing information of downloadable files."
        type: object
        properties:
          text/csv:
            $ref: '#/definitions/DownloadObject'
          application/vnd.ms-excel:
            $ref: '#/definitions/DownloadObject'
      edition:
        description: "The edition of the dataset version"
        type: string
      etag:
        type: string
      events:
        description: "A list of events took place for this job"
        readOnly: true
        type: array
        items:
          $ref: '#/definitions/Event'
      issued:
        description: "The time when this instance was published"
        type: string
        format: date-time
      last_updated:
        description: "The last time an event happened"
        readOnly: true
        type: string
      _links:
        type: object
        properties:
          dataset:
            description: "An object describing the ID and URL for a dataset which is associated with this instance"
            readOnly: true
            type: object
            properties:
              href:
                description: "The URL for the dataset associated with this instance"
                example: "http://localhost:22000/datasets/95c4669b-3ae9-4ba7-b690-87e890a1c67c"
                type: string
              id:
                description: "The ID of the dataset associated with this instance"
                example: "95c4669b-3ae9-4ba7-b690-87e890a1c67c"
                type: string
          edition:
            description: "An object describing the ID and URL for the dataset edition that is associated with this instance"
            readOnly: true
            type: object
            properties:
              href:
                description: "The URL for the dataset edition associated with this instance"
                example: "http://localhost:22000/datasets/95c4669b-3ae9-4ba7-b690-87e890a1c67c/editions/2017"
                type: string
              id:
                description: "The ID for the dataset edition associated with this instance"
                type: string
          self:
            description: "An object describing the ID and URL for a dataset which is associated with this instance"
            readOnly: true
            type: object
            properties:
              href:
                description: "The URL for this resource"
                example: "http://localhost:22000/instances/45c4669b-3ae9-4ba7-b690-87e890a1c67f"
                type: string
          spatial_resolution:
            description: "A link object describing the url to a list of geography ranges for the version of the dataset"
            type: object
            properties:
              href:
                description: "A url to a list of geography ranges for the version of the dataset"
                type: string
          version:
            description: "An object describing the ID and URL of the dataset version associated with this instance"
            readOnly: true
            type: object
            properties:
              href:
                description: "The URL for the dataset version associated with this instance"
                example: 'http://localhost:21800/dataset/042e216a-7822-4fa0-a3d6-e3f5248ffc35/edition/2017/version/1'
                type: string
              id:
                description: "The ID of the dataset version associated with this instance"
                example: "042e216a-7822-4fa0-a3d6-e3f5248ffc35"
                type: string
          next_version:
            type: string
            format: url
          previous_version:
            type: string
            format: url
      release_date:
        description: "The release date of this version of the dataset"
        type: string
      state:
        $ref: '#/definitions/State'
      temporal_coverage:
        $ref: '#/definitions/Temporal'
      temporal_resolution:
        description: ""
        type: string
      table_schema:
        $ref: '#/definitions/TableSchema'
      version:
        description: "The dataset version number that this instance is associated with, this will only be set once the state has been updated to `edition-confirmed`"
        readOnly: true
        type: integer
  Instances:
    description: "A list of instance resources, if query parameter state is set return all instances with that state"
    type: object
    properties:
      count:
        description: "The number of instances returned"
        type: integer
      items:
        type: array
        items:
          $ref: '#/definitions/Instance'
      _links:
        $ref: '#/definitions/ListLinks'
      limit:
        description: "The number of instances requested"
        type: integer
      offset:
        description: "The first row of instances to retrieve, starting at 0. Use this parameter as a pagination mechanism along with the limit parameter"
        type: integer
      total_count:
        description: "The total number of instances"
        type: integer
  LatestChange:
    description: "A single change between this version and the previous version of an edition for a dataset"
    type: object
    properties:
      description:
        description: "A description of what has changed between versions"
        type: string
      name:
        description: "The name of the change that has occurred between versions"
        type: string
        example: "changes in classification"
      type:
        description: "The type of change"
        type: string
        example: "summary of changes"
  ListLinks:
    description: "The _links structure provided on all list endpoints"
    type: object
    properties:
      self:
        $ref: '#/definitions/SelfLink'
      next:
        type: object
        properties:
          href: 
            type: string
      prev:
        type: object
        properties:
          href: 
            type: string
  ListPagination:
    description: "The fields required on a list endpoint to facilitate pagination"
    properties:
      _links:
        $ref: '#/definitions/ListLinks'
      count:
        description: "The number of versions returned for an edition of a dataset"
        readOnly: true
        type: integer
      limit:
        description: "The number of editions requested for a dataset"
        type: integer
      offset:
        description: "The first row of editions for a dataset to retrieve, starting at 0. Use this parameter as a pagination mechanism along with the limit parameter"
        type: integer
      total_count:
        description: "The total number of editions against a dataset"
        readOnly: true
        type: integer
  NewDatasetResponse:
    description: "A model for the response body when creating a new dataset"
    type: object
    properties:
      id:
        description: "An unique id for a dataset"
        example: "DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC"
        type: string
      current:
        allOf:
        - type: object
          properties:
            collection_id:
              $ref: '#/definitions/CollectionID'
            type:  
              $ref: '#/definitions/Type'
        - $ref: "#/definitions/Dataset"
      next:
        allOf:
        - type: object
          properties:
            collection_id:
              $ref: '#/definitions/CollectionID'
            type:  
              $ref: '#/definitions/Type'
        - $ref: "#/definitions/Dataset"
  NewInstance:
    description: "A model for the request and response body for creating a new instance"
    type: object
    properties:
      dimensions:
        description: "A list of codelists for each dimension of this instance"
        type: array
        items:
          $ref: '#/definitions/Codelist'
      id:
        description: "A unique id for an instance"
        readOnly: true
        type: string
      links:
        type: object
        properties:
          dataset:
            description: "An object describing the ID and URL for a dataset which is associated with this instance"
            type: object
            properties:
              href:
                description: "The URL for the dataset associated with this instance"
                example: "http://localhost:22000/datasets/95c4669b-3ae9-4ba7-b690-87e890a1c67c"
                type: string
              id:
                description: "The ID of the dataset associated with this instance"
                example: "95c4669b-3ae9-4ba7-b690-87e890a1c67c"
                type: string
          job:
            description: "An object describing the ID and URL of the job containing this instance"
            required: ["id", "href"]
            type: object
            properties:
              href:
                description: "The URL for the job containing this instance"
                example: "http://localhost:21800/jobs/042e216a-7822-4fa0-a3d6-e3f5248ffc35"
                type: string
              id:
                description: "The ID of the job containing this instance"
                example: 042e216a-7822-4fa0-a3d6-e3f5248ffc35
                type: string
          self:
            description: "An object describing the ID and URL for a dataset which is associated with this instance"
            readOnly: true
            type: object
            properties:
              href:
                description: "The URL for this resource"
                example: "http://localhost:22000/instances/45c4669b-3ae9-4ba7-b690-87e890a1c67f"
                type: string
      state:
        description: "The state of the resource, this can only have a value of `created`"
        type: string
        readOnly: true
  NewVersionResponse:
    description: "A model for the response body when creating a new version for an edition of a dataset"
    allOf:
      - type: object
        properties:
          collection_id:
            $ref: '#/definitions/CollectionID'
          id:
            type: string
            description: "An unique id for a dataset"
            example: "DE3BC0B6-D6C4-4E20-917E-95D7EA8C91CD"
      - $ref: "#/definitions/Version"
  State:
    description: |
      The state of the resource, can only be one of the following:
        * created
        * completed (instances only)
        * failed (instances only)
        * edition-confirmed (instances and versions only)
        * associated (not editions)
        * published
    type: string
  TableSchema:
    description: "The schema defining a CSV on the Web distribution of a dataset version"
    type: object
    properties:
      about_url:
        type: string
        format: url
      column:
        type: array
        items:
          properties:
            component_type:
              type: string
            datatype:
              type: string
            name:
              type: string
            # label:
            #   type: string
            # description:
            #   type: string
            title:
              type: string
            property_url:
              type: string
              format: url
            value_url:
              type: string
              format: url
            codelist_url:
              type: string
              format: url
            sub_property_of:
              type: string
  Temporal:
    description: "A list of frequencies the dataset covers for a particular period of time"
    type: array
    items:
      type: object
      properties:
        start_date:
          description: "The start date of the time period in which the version of the dataset covers this frequency"
          type: string
        end_date:
          description: "The end date of the time period in which the version of the dataset covers this frequency"
          type: string
        frequency:
          description: "The time frequency the version of the dataset covers for the period of time between start_date and end_date"
          type: string
  UpdateDatasetResponse:
    description: "A model for the response body when creating a new dataset"
    type: object
    properties:
      id:
        description: "An unique id for a dataset"
        example: "DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC"
        type: string
      current:
        allOf:
        - type: object
          properties:
            collection_id:
              $ref: '#/definitions/CollectionID'
        - $ref: "#/definitions/Dataset"
      next:
        allOf:
        - type: object
          properties:
            collection_id:
              $ref: '#/definitions/CollectionID'
        - $ref: "#/definitions/Dataset"
  UpdateDownloadObject:
    description: "Object containing information of a downloadable file"
    type: object
    properties:
      href:
        description: "The URL to the generated file"
        type: string
      size:
        description: "The size of the file in bytes"
        type: string
      public:
        description: "The URL to a public-accessible download"
        type: string
      private:
        description: "The URL to a non public-accessible download"
        type: string
  UpdateVersion:
    description: "An object containing information to be updated on a version resource"
    type: object
    properties:
      alerts:
        description: "A list of alerts, for example corrections after the resource has been published"
        type: array
        items:
          $ref: '#/definitions/Alert'
      collection_id:
        $ref: '#/definitions/CollectionID'
      downloads:
        description: "A selection of download objects containing information of downloadable files. These can only be updated via an authorised caller."
        type: object
        properties:
          csv:
            $ref: '#/definitions/DownloadObject'
          xls:
            $ref: '#/definitions/DownloadObject'
      latest_changes:
        description: "A list of changes between version of an edition for a dataset and the previous version of the same dataset edition"
        type: array
        items:
          $ref: '#/definitions/LatestChange'
      links:
        $ref: '#/definitions/VersionLinks'
      release_date:
        description: "The release date of this version of the dataset"
        type: string
      state:
        $ref: '#/definitions/State'
      temporal:
        $ref: '#/definitions/Temporal'
      version:
        description: "A number identifying the version for an edition from a dataset"
        example: 1
        readOnly: true
        type: integer
  Versions:
    # type: object
    allOf:
      - $ref: '#/definitions/ListPagination'
      - type: object
        properties:
          "@context":
            $ref: '#/definitions/LDContext'
          items:
            description: "An array of Datasets"
            type: array
            items:
              allOf:
              - $ref: '#/definitions/dcatSeriesCore'
              - $ref: '#/definitions/dcatVersionCore'
              - type: object
                properties:
                  etag:
                    type: string
                  "@id":
                    $ref: '#/definitions/LDID'
                  "@type":
                    $ref: '#/definitions/LDType'
                  _links:
                    $ref: '#/definitions/SelfLink'
                  state:
                    $ref: '#/definitions/State'
  Version:
    description: "An object containing information about published datasets from the ONS"
    required: [
      release_date,
    ]
    allOf:
    - $ref: '#/definitions/dcatSeriesFull'
    - $ref: '#/definitions/dcatVersionFull'
    - type: object
      properties:
        "@context":
          $ref: '#/definitions/LDContext'
        "@id":
          $ref: '#/definitions/LDID'
        "@type":
          $ref: '#/definitions/LDType'
        etag:
          type: string
        is_based_on:
          $ref: '#/definitions/IsBasedOn'
        _links:
          $ref: '#/definitions/VersionLinks'
        type:
          $ref: '#/definitions/Type'
        next_version:
          type: string
          format: uri
        previous_version:
          type: string
          format: uri
        state:
          $ref: '#/definitions/State'
 
  # Link objects
  DatasetLinks:
    description: "A list of links related to this resource"
    type: object
    properties:
      editions:
        readOnly: true
        type: object
        properties:
          href:
            description: "A URL to all editions for this dataset"
            example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC/editions"
            type: string
      latest_version:
        $ref: '#/definitions/LatestVersionLink'
      self:
        $ref: '#/definitions/SelfLink'
  DatasetListLinks:
    description: "A list of links related to this resource, in the context of a list of datasets"
    type: object
    properties:
      latest_version:
        $ref: '#/definitions/LatestVersionLink'
      self:
        $ref: '#/definitions/SelfLink'
  EditionLinks:
    description: "A list of links related to this resource"
    readOnly: true
    type: object
    properties:
      dataset:
        $ref: '#/definitions/DatasetLink'
      editions:
        readOnly: true
        type: object
        properties:
          href:
            description: "A URL to all editions for this dataset"
            example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC/editions"
            type: string
      latest_version:
        $ref: '#/definitions/LatestVersionLink'
      self:
        $ref: '#/definitions/SelfLink'
      versions:
        type: object
        properties:
          href:
            description: "A URL to all versions dor an edition of a dataset"
            example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC/edition/2017/versions"
            type: string
      next:
        type: object
        properties:
          href:
            type: string
            format: url
          id:
            type: string
      prev:
        type: object
        properties:
          href:
            type: string
            format: url
          id:
            type: string
  VersionLinks:
    description: "A list of links related to this resource"
    type: object
    properties:
      dataset:
        $ref: '#/definitions/DatasetLink'
      edition:
        $ref: '#/definitions/EditionLink'
      self:
        $ref: '#/definitions/SelfLink'
      versions:
        type: object
        properties:
          href:
            description: "A URL to all versions dor an edition of a dataset"
            example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC/edition/2017/versions"
            type: string
      next:
        type: object
        properties:
          href:
            type: string
            format: url
          id:
            type: string
      prev:
        type: object
        properties:
          href:
            type: string
            format: url
          id:
            type: string
  DatasetLink:
    description: "An object containing the dataset id and link"
    readOnly: true
    type: object
    properties:
      href:
        description: "A URL to the parent dataset for this resource"
        example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC"
        type: string
      id:
        description: "The unique id for the dataset of this version"
        type: string
  EditionLink:
    description: "An object containing the edition and link"
    readOnly: true
    type: object
    properties:
      href:
        description: "A URL to the dataset edition for a version"
        example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC/editions/2017"
        type: string
      id:
        description: "The unique id for the dataset edition for a version"
        type: string
  LatestVersionLink:
    description: "An object containing the latest version id and link"
    type: object
    readOnly: true
    properties:
      href:
        description: "A link to the latest version and edition of the dataset"
        example: "http://localhost:8080/datasets/DE3BC0B6-D6C4-4E20-917E-95D7EA8C91DC/editions/2017/versions/2"
        type: string
      id:
        description: "The unique id for the latest version of a dataset"
        type: "string"
  SelfLink:
    description: "A link to this resource"
    readOnly: true
    type: object
    properties:
      href:
        description: "A URL to this resource"
        type: string
  SpatialLink:
    type: object
    properties:
      href:
        description: "A url to a list of geography ranges for the version of the dataset"
        type: string
  TaxonomyLink:
    description: "A link to the taxonomy of the dataset"
    type: object
    properties:
      href:
        description: "A url to the taxonomy of the dataset"
        type: string
  VersionLink:
    description: "The dataset version this resource belongs to"
    type: object
    properties:
      href:
        description: "A URL to the version this resource relates to"
        type: string
      id:
        description: "The version number this resource relates to"
        type: string